# Codex Working Protocol

## 목표
- 최소 수정으로 문제 해결
- 불필요한 리팩토링 금지
- 기존 동작 안정성 우선

## 컨텍스트 우선순위
1. `PROJECT_STATE.md`
2. `README.md`
3. `docs/command.md`
4. 코드 주석 및 관련 패키지 문서
5. 기타 문서

## 수정 전 필수 단계
1. 변경 예정 파일 목록을 먼저 제시한다.
2. 수정 이유를 3줄 이내로 요약한다.
3. 영향 범위(런타임, 토픽, launch, API)를 간단히 분석한다.

## 수정 원칙
- public API/토픽/서비스 인터페이스는 사용자 승인 없이 변경하지 않는다.
- 새 의존성은 사용자 승인 없이 추가하지 않는다.
- 기존 로직 전체 재작성 대신 국소 패치를 우선한다.
- 대규모 포맷 변경은 금지한다.

## 수정 후 필수 단계
1. 관련 검증 명령을 반드시 실행한다.
2. 실패 시 로그를 요약하고, 원인 가설을 세운 뒤 수정-재검증을 반복한다.
3. 최종 보고에 `실행 명령`, `결과`, `변경 diff 요약`을 포함한다.

## 테스트 정책
- 모든 수정 후 최소 1개 이상 검증 명령을 실행한다.
- 회귀 검증 기준은 `tests/regression_cases.md`를 우선한다.
- ROS2 launch 검증은 가능한 경우 `--show-args` 또는 단기 실행으로 시작한다.
- 하드웨어 의존 테스트는 명령과 기대 결과를 기록하고, 미실행 시 사유를 명시한다.

## 금지 사항
- 무관한 파일 수정 금지
- 빌드 산출물/로그 파일 커밋 금지
- 사용자 요청 없는 파괴적 git 명령 금지

## 결과 보고 형식
1. 변경 파일 목록
2. 핵심 수정 내용
3. 실행한 검증 명령과 결과
4. 잔여 리스크/후속 작업

## 변경 로그
- 2026-03-01: `llm_cpp`가 Ollama 직접 호출에서 llama.cpp HTTP 서버 직접 관리/호출 구조로 마이그레이션됨 (`-ngl 99` 기본값, health-check/restart 포함).
