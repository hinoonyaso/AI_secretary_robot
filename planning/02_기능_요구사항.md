# 기능 요구사항

## JetRover AI 아키텍처

**최종 통합 기술 설계 문서**  
버전 3.0 | 2026년 2월

---

## 음성 인터랙션

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| F-001 | 웨이크워드 감지 | "JetRover" 웨이크워드 상시 감지 | 필수 |
| F-002 | 음성 활동 감지 (VAD) | 발화 시작/종료 자동 감지 | 필수 |
| F-003 | 한국어 음성 인식 (STT) | moonshine-tiny-ko 기반 실시간 STT | 필수 |
| F-004 | 의도 분류 | KoSimCSE 기반 사용자 의도 분류 | 필수 |
| F-005 | 자연어 이해/응답 | Qwen2.5-1.5B 기반 대화 및 명령 해석 | 필수 |
| F-006 | 한국어 TTS | Piper TTS 기반 음성 출력 | 필수 |
| F-007 | 음성 응답 지연 | 발화 → 첫 음절 < 1.5초 | 필수 |

### 음성 처리 파이프라인
```
Porcupine (C SDK) → sherpa-onnx VAD → sherpa-onnx STT (moonshine GPU) 
→ KoSimCSE → Intent Router → llama.cpp LLM → sherpa-onnx TTS (Piper)
```

---

## 자율 이동

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| F-101 | SLAM | RPLIDAR A1 기반 맵핑 및 위치 추정 | 필수 |
| F-102 | 경로 계획 | A* 전역 계획 + DWB 로컬 제어 | 필수 |
| F-103 | 장애물 회피 | 실시간 장애물 감지 및 회피 | 필수 |
| F-104 | 목표 지점 이동 | 음성/토픽 기반 목표 지점 이동 | 필수 |
| F-105 | 객체 추적 | YOLO11n 기반 객체 감지 및 추적 | 필수 |

### 네비게이션 스택
- **SLAM**: slam_toolbox (localization/mapping 모드)
- **전역 플래너**: A* 알고리즘
- **로컬 플래너**: DWB (Dynamic Window Approach 개선版)
- **코스트맵**: 레이어 기반 글로벌/로컬 코스트맵

---

## 로봇암 조작

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| F-201 | 역기구학 계산 | trac-ik 기반 6DOF IK 계산 | 필수 |
| F-202 | 경로 계획 | MoveIt2 OMPL 기반 충돌 회피 경로 | 필수 |
| F-203 | 그리퍼 제어 | 개폐 동작 제어 | 필수 |
| F-204 | 팬틸트 제어 | 치메라 실시간 시선 제어 | 필수 |
| F-205 | 집기 동작 | 객체 인식 → 접근 → 집기 시퀀스 | 선택 |

### MoveIt2 구성

**플래닝 그룹**
- arm 그룹: joint1~joint6 (HTD-35H3 ×6), end-effector: gripper_link
- gripper 그룹: gripper_joint (HTS-21H ×1), 독립 액션 서버
- pan_tilt: MoveIt2 제외 → 독립 토픽 제어

**trac-ik 설정**
```yaml
solve_type: Speed
kinematics_solver_timeout: 0.05  # 50ms
kinematics_solver_attempts: 3
```

---

## 비전 분석

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| F-301 | 객체 감지 | YOLO11n 기반 실시간 객체 감지 | 필수 |
| F-302 | 장면 분석 (VLM) | moondream2 기반 이미지 캡셔닝/VQA | 선택 |
| F-303 | OCR | RapidOCR 기반 텍스트 인식 | 선택 |
| F-304 | 깊이 추정 | RGB-D 기반 거리 측정 | 필수 |

### 비전 파이프라인
```
DaBai DCW RGB-D → YOLO11n TRT (객체 감지)
                → moondream2 GGUF (VLM, 정지 시)
                → RapidOCR ONNX (OCR, 요청 시)
```

---

## 기능 의존성 다이어그램

```
                    ┌─────────────┐
                    │   사용자    │
                    └──────┬──────┘
                           │ 음성
                           ▼
                    ┌─────────────┐
                    │  웨이크워드  │
                    └──────┬──────┘
                           │
           ┌───────────────┼───────────────┐
           ▼               ▼               ▼
    ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
    │  자율이동   │ │  로봇암    │ │  비전분석   │
    │  (Nav2)    │ │ (MoveIt2)  │ │  (YOLO/VLM) │
    └──────┬──────┘ └──────┬──────┘ └──────┬──────┘
           │               │               │
           └───────────────┼───────────────┘
                           ▼
                    ┌─────────────┐
                    │   응답     │
                    │  (TTS)    │
                    └─────────────┘
```

---

*JetRover AI Architecture v3.0 | Jetson Orin Nano 8GB + ROS2 Humble + 6DOF Mecanum*
