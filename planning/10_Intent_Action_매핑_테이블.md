# Intent→Action 매핑 테이블

## JetRover AI 아키텍처

**최종 통합 기술 설계 문서**  
버전 3.0 | 2026년 2월

---

## 의도-액션 매핑

| 의도 (Intent) | 키워드/패턴 | 액션 | 실행 조건 | 파라미터 |
|---------------|-------------|------|-----------|----------|
| WAKE_WORD | "JetRover" | 마이크 STT 모드 전환 | 상시 | - |
| MOVE_TO | "가줘", "이동해", "가서" | Nav2 goal 전송 | 정지 상태 | target_location |
| FOLLOW | "따라와", "따라가", "팔로우" | 객체 추적 모드 | YOLO 감지 중 | target_object |
| STOP | "정지", "멈춰", "그만" | Emergency Stop | 항상 | - |
| PICK | "집어", "줘", "가져와" | 집기 시퀀스 | 객체 감지 + 접근 완료 | target_object |
| PLACE | "놓아", "날려", "두고 와" | 놓기 시퀀스 | 그리퍼 보유 중 | target_location |
| SCAN_SCENE | "뭐 있어", "보여줘", "설명해" | VLM 호출 | 정지 상태 | - |
| READ_TEXT | "읽어줘", "뭐라고 써 있어" | OCR 호출 | 정지 상태 | - |
| GREETING | "안녕", "반가워" | 인사 응답 | 항상 | - |
| QUESTION | "뭐야", "어디", "언제" | LLM 일반 응답 | 항상 | query |
| ARM_MOVE | "팔을", "손을" | MoveIt 궤적 실행 | 정지 상태 | joint_positions |
| GRIPPER_OPEN | "펼쳐", "열어" | 그리퍼 개방 | 항상 | - |
| GRIPPER_CLOSE | "잡아", "닫아" | 그리퍼 폐쇄 | 항상 | - |
| PAN_TILT | "여기 봐", "저기 봐" | 팬틸트 제어 | 항상 | pan_angle, tilt_angle |
| MAPPING_START | "맵핑", "지도 만들어" | SLAM 모드 전환 | 정지 상태 | - |
| MAPPING_STOP | "맵핑 끝", "저장해" | 맵 저장 | 맵핑 중 | map_name |
| LOCALIZE | "여기가 어디야" | 현재 위치 응답 | localization 중 | - |

---

## 의도 분류 신뢰도 임계값

| 의도 유형 | 신뢰도 임계값 | 낮은 신뢰도 시 동작 |
|-----------|---------------|---------------------|
| 안전 관련 (STOP, Emergency) | 0.5 | 즉시 실행 |
| 이동/조작 | 0.75 | 확인 질문 |
| 일반 대화 | 0.6 | LLM 일반 응답 |
| VLM/OCR | 0.7 | 확인 질문 |

---

## 액션 상세 정의

### MOVE_TO

**설명:** 지정된 위치로 이동

**파라미터:**
| 이름 | 타입 | 설명 | 예시 |
|------|------|------|------|
| target_location | string | 목적지 이름 | "주방", "거실", "A구역" |
| target_pose | PoseStamped | 좌표 (선택) | {x: 1.0, y: 2.0} |

**실행 시퀀스:**
```
1. 현재 위치 확인
2. 목표 위치 좌표 조회 (맵 기반)
3. Nav2 goal 전송
4. 이동 완료 대기
5. 완료 알림 (TTS)
```

**오류 처리:**
- 목표 위치 미정의: "목표 위치를 알 수 없습니다"
- 경로 계획 실패: "경로를 찾을 수 없습니다"

---

### PICK

**설명:** 객체 집기

**파라미터:**
| 이름 | 타입 | 설명 | 예시 |
|------|------|------|------|
| target_object | string | 객체 클래스 | "컵", "병", "공" |
| object_id | int | 객체 ID (선택) | YOLO detection ID |

**실행 시퀀스:**
```
1. YOLO로 객체 탐지
2. 객체 위치로 이동 (Nav2)
3. 팔 IK 계산
4. 접근 궤적 실행
5. 그리퍼 닫기
6. 들어 올리기
7. 완료 알림 (TTS)
```

**전제 조건:**
- 객체가 YOLO detection 범위 내
- 객체 접근 가능 위치

---

### SCAN_SCENE

**설명:** VLM을 이용한 장면 분석

**파라미터:** 없음

**실행 시퀀스:**
```
1. "분석 중입니다..." TTS 출력
2. YOLO 언로드
3. LLM KV 캐시 초기화
4. moondream2 로드
5. 이미지 캡셔닝/VQA 실행
6. 결과 TTS 출력
7. YOLO 재적재
```

**주의:** VLM 실행 중 YOLO 객체 감지 일시 중단

---

## Intent 분류 모델

### KoSimCSE 설정

| 속성 | 값 |
|------|-----|
| 모델 | KoSimCSE-roberta |
| 실행 환경 | CPU (FP32) |
| 임베딩 차원 | 768 |
| 분류 임계값 | 코사인 유사도 0.75 |

### 의도 임베딩 예시

```python
intent_embeddings = {
    "MOVE_TO": "목적지로 이동하다 가다",
    "PICK": "물건을 집어 들다 잡다",
    "STOP": "멈추다 정지하다 그만",
    "SCAN_SCENE": "보여주다 설명하다 뭐가 있어",
    # ...
}
```

---

## Intent Router 아키텍처

```
┌──────────────┐
│   STT 결과   │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ KoSimCSE     │
│ 임베딩 생성   │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 코사인 유사도 │
│ 계산          │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 임계값 필터   │
└──────┬───────┘
       │
   ┌───┴───┐
   ▼       ▼
┌─────┐ ┌─────┐
|Pass │ │Fail │
└──┬──┘ └──┬──┘
   │       │
   ▼       ▼
┌─────┐ ┌──────────┐
│액션  │ │ LLM 일반 │
│실행  │ │ 응답     │
└─────┘ └──────────┘
```

---

## 음성 명령 처리 시퀀스

### 일반 명령

```
1. Porcupine 웨이크워드 감지
   └──> /wake_word 발행
   │
2. 마이크 핸들 STT로 전환
   │
3. Nav2 velocity smoother 속도 0 명령 발행
   │
4. odom 속도 < 0.05m/s 확인 (완전 정지)
   │
5. 사용자 발화 수집 (VAD 종료 감지)
   │
6. STT 실행 → 텍스트 획득
   │
7. Intent 분류 (KoSimCSE)
   │
8. [조걸 분기]
   ├──> 신뢰도 ≥ 임계값: 액션 실행
   └──> 신뢰도 < 임계값: LLM 일반 응답
   │
9. 액션 결과 또는 LLM 응답
   │
10. TTS 출력
    │
11. Porcupine 재활성
```

### VLM 호출 시퀀스

```
1. "장면 분석" 인텐트 감지
   │
2. TTS "분석 중입니다..." 브리징 출력
   │
3. YOLO TRT 엔진 unload() → ~400MB 회수
   │
4. LLM KV 캐시 초기화
   │
5. moondream2 GGUF 로드
   │
6. 이미지 인코딩 → 추론
   │
7. 결과 TTS 출력
   │
8. YOLO TRT 엔진 재적재 (~200ms)
```

---

## 오류 처리

| 상황 | 응답 | 조치 |
|------|------|------|
| 의도 불명확 | "무엇을 도와드릴까요?" | LLM 일반 응답 |
| 실행 조건 불만족 | "지금은 할 수 없습니다" | 조건 충족 대기 |
| 액션 실패 | "실패했습니다. 다시 시도할까요?" | 재시도 또는 취소 |
| 타임아웃 | "응답이 지연되고 있습니다" | 상태 확인 |

---

*JetRover AI Architecture v3.0 | Jetson Orin Nano 8GB + ROS2 Humble + 6DOF Mecanum*
