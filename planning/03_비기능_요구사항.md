# 비기능 요구사항

## JetRover AI 아키텍처

**최종 통합 기술 설계 문서**  
버전 3.0 | 2026년 2월

---

## 성능 요구사항

| ID | 요구사항 | 목표값 | 측정 방법 |
|----|----------|--------|-----------|
| NF-001 | 음성 응답 지연 | < 1.5초 | 발화 종료 → TTS 첫 음절 |
| NF-002 | STT 처리 지연 | < 300ms | 3초 발화 기준 |
| NF-003 | LLM TTFT | < 500ms | 첫 토큰 생성 시간 |
| NF-004 | VLM 응답 시간 | < 4초 | 이미지 → 텍스트 완료 |
| NF-005 | IK 계산 시간 | < 10ms | 6DOF IK 해결 |
| NF-006 | 경로 계획 시간 | < 500ms | 일반 환경 기준 |
| NF-007 | 객체 감지 FPS | > 15fps | YOLO11n 기준 |
| NF-008 | 로봇암 제어 주파수 | 50Hz | 서보 명령 주기 |

### 전체 파이프라인 지연 분석

| 파이프라인 단계 | 지연 | 실행주체 | 비고 |
|-----------------|------|----------|------|
| Porcupine 웨이크워드 감지 | ~10ms | CPU | 상시 대기 |
| Silero VAD 발화 끝 판단 | ~50ms | CPU | sherpa-onnx 내장 |
| moonshine-tiny-ko STT (3초 발화) | ~250ms | GPU | sherpa-onnx GPU |
| KoSimCSE 인텐트 분류 | ~80ms | CPU | |
| qwen2.5-1.5b TTFT (스트리밍) | ~450ms | GPU | n_predict:128, temp:0.3 |
| Piper TTS 첫 문장 합성 | ~120ms | CPU | |
| **음성 응답 총 지연 (발화 → 첫 음절)** | **~960ms** | | **목표 <1.5s 달성** |

---

## 자원 요구사항

| ID | 요구사항 | 목표값 | 비고 |
|----|----------|--------|------|
| NF-101 | 메모리 사용량 | < 6GB | 상시 적재 기준 |
| NF-102 | CPU 사용량 | < 80% | 6코어 기준 |
| NF-103 | GPU 사용량 | < 90% | 추론 시 |
| NF-104 | 전력 소비 | < 15W | Jetson TDP 준수 |
| NF-105 | 디스크 사용량 | < 16GB | 시스템 전체 |

### CPU 코어 점유 분석 (6코어 Cortex-A78AE)

| 코어 | 할당 | 점유율 | 설명 |
|------|------|--------|------|
| C0~C1 | ros2_control + CycloneDDS | ~1.0코어 | 100Hz 실시간 제어 |
| C2 | slam_toolbox | ~0.5코어 | localization 모드 |
| C3 | Nav2 A* + DWB | ~0.5~2코어 | 경로 재계획 시 급증 |
| C4 | Silero VAD + Piper TTS + KoSimCSE | ~0.5~1코어 | 음성 처리 |
| C5 | llama.cpp 스케줄러 | ~0.3코어 | GPU 보조, nice +10 |

**일반 상태**: 2.8~3.5코어 점유  
**피크(A* + OCR + TTS 동시)**: 4.5~5.5코어  
⚠️ ros2_control nice -20으로 최우선 보장 필요

---

## 안정성 요구사항

| ID | 요구사항 | 목표값 | 비고 |
|----|----------|--------|------|
| NF-201 | 시스템 가동률 | > 99% | 24/7 상시 대기 |
| NF-202 | 음성 인식 정확도 | > 90% | 정숙한 환경 기준 |
| NF-203 | 의도 분류 정확도 | > 85% | KoSimCSE 기준 |
| NF-204 | 납비 실패율 | < 1% | 정상 동작 시 |
| NF-205 | 충돌 방지 | 100% | 장애물 감지 시 |

### 장애 대응 정책

| 조건 | 레벨 | 조치 |
|------|------|------|
| 온도 ≥ 70°C 5초 연속 | Level 1 | VLM 비활성 |
| RAM < 2.5GB | Level 2 | LLM 비활성 |
| 온도 ≥ 80°C or RAM < 1.5GB | Level 3 | YOLO만 유지, 나머지 중단 |

---

## 보안 요구사항

| ID | 요구사항 | 설명 |
|----|----------|------|
| NF-301 | 오프라인 우선 | 네트워크 단절 시 완전 동작 |
| NF-302 | 로컬 처리 | 모든 AI 추론 Edge에서 수행 |
| NF-303 | 선택적 클라우드 | 클라우드는 품질 향상 수단으로만 사용 |

### 데이터 흐름
```
[마이크] ──로컬──> [STT] ──로컬──> [LLM] ──로컬──> [TTS] ──로컬──> [스피커]
                                    │
                                    ▼
                              [클우드 - 선택적]
                              (품질 향상용만)
```

---

## 호환성 요구사항

| ID | 요구사항 | 설명 |
|----|----------|------|
| NF-401 | ROS2 Humble | Ubuntu 22.04 기준 LTS |
| NF-402 | JetPack 6.x | Jetson Orin Nano 공식 지원 |
| NF-403 | CUDA 12.6 | TensorRT 호환성 |
| NF-404 | glibc ≥ 2.32 | sherpa-onnx 요구사항 (Ubuntu 22.04 = 2.35 OK) |

---

*JetRover AI Architecture v3.0 | Jetson Orin Nano 8GB + ROS2 Humble + 6DOF Mecanum*
